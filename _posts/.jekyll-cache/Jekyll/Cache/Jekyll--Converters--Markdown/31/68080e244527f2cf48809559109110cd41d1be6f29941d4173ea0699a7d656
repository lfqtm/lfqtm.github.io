I"Ì\<h2 id="è¯·æ±‚ä¸å“åº”requestresponse">è¯·æ±‚ä¸å“åº”(Request&amp;Response)</h2>

<p><img src="/images/posts/Request.assets/image-20200418200649988.png" alt="image-20200418200649988" /></p>

<p><strong>requestå¯¹è±¡å’Œresponseå¯¹è±¡çš„åŸç†</strong></p>

<ol>
  <li>requestå’Œresponseå¯¹è±¡æ˜¯ç”±æœåŠ¡å™¨åˆ›å»ºçš„,æˆ‘ä»¬åªèƒ½è°ƒç”¨</li>
  <li>requestå¯¹è±¡æ˜¯æ¥è·å–è¯·æ±‚æ¶ˆæ¯,responseå¯¹è±¡æ˜¯æ¥è®¾ç½®å“åº”æ¶ˆæ¯</li>
</ol>

<h3 id="è¯·æ±‚request">è¯·æ±‚Request</h3>

<h4 id="1-requestå¯¹è±¡ç»§æ‰¿ä½“ç³»ç»“æ„">1. requestå¯¹è±¡ç»§æ‰¿ä½“ç³»ç»“æ„</h4>

<p>SerletRequst  â€“æ¥å£
    | ç»§æ‰¿
HttpServletRequest â€“æ¥å£
	| å®ç°
org.apache.catalina.connector.RequestFacade â€“ç±»(tomcatæºç å®ç°)</p>

<h4 id="2-requeståŠŸèƒ½">2. requeståŠŸèƒ½</h4>

<h5 id="1-è·å–è¯·æ±‚æ¶ˆæ¯æ•°æ®">1. è·å–è¯·æ±‚æ¶ˆæ¯æ•°æ®</h5>

<blockquote>
  <p>æ•°æ®æ ¼å¼: è¯·æ±‚è¡Œ,è¯·æ±‚å¤´,è¯·æ±‚ç©ºè¡Œ,è¯·æ±‚ä½“</p>
</blockquote>

<ol>
  <li>
    <p>è·å–è¯·æ±‚è¡Œæ•°æ®</p>

    <p><code class="highlighter-rouge">GET /day14/demo1?name=zhangsan HTTP/1.1</code></p>

    <p>æ–¹æ³•:  å¯ä»¥ç”¨æ¥åŒºåˆ†ç”¨æˆ·çš„æµè§ˆå™¨åšæµè§ˆå™¨é€‚é…</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1.è·å–è¯·æ±‚æ–¹å¼: GET</span>
<span class="nc">String</span> <span class="nf">getMethod</span><span class="o">();</span>
<span class="c1">// 2.è·å–è™šæ‹Ÿç›®å½•: /day14  </span>
<span class="nc">String</span> <span class="nf">getContextPath</span><span class="o">();</span> <span class="c1">// å¸¸ç”¨</span>
<span class="c1">// 3.è·å–Servletè·¯å¾„: /demo1</span>
<span class="nc">String</span> <span class="nf">getServletPath</span><span class="o">();</span>
<span class="c1">// 4.è·å–getæ–¹å¼è¯·æ±‚å‚æ•°: name=zhangsan</span>
<span class="nc">String</span> <span class="nf">getQueryString</span><span class="o">();</span>
<span class="c1">// 5.è·å–è¯·æ±‚çš„URIä»¥åŠURL: /day14/demo1  http://localhost/day14/demo1</span>
<span class="cm">/**
URL: åŒç»Ÿä¸€èµ„æºå®šä½ç¬¦  ä¸­åäººæ°‘å…±å’Œå›½
URI: ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦  å…±å’Œå›½
*/</span>
<span class="nc">String</span> <span class="nf">getRequestURI</span><span class="o">();</span> <span class="c1">// å¸¸ç”¨</span>
<span class="nc">StringBuffer</span> <span class="nf">getRequestURL</span><span class="o">();</span>  
<span class="c1">// 6.è·å–åè®®åŠç‰ˆæœ¬: HTTP/1.1</span>
<span class="nc">String</span> <span class="nf">getProtocol</span><span class="o">();</span>
<span class="c1">// 7.è·å–å®¢æˆ·æœºçš„IPåœ°å€</span>
<span class="nc">String</span> <span class="nf">getRemoteAddr</span><span class="o">();</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>è·å–è¯·æ±‚å¤´æ•°æ®</p>

    <ul>
      <li><code class="highlighter-rouge">String getHeader(String name); </code> é€šè¿‡è¯·æ±‚å¤´åç§°è·å–è¯·æ±‚å¤´çš„å€¼ (<strong>ä¸»è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</strong>)</li>
      <li><code class="highlighter-rouge">Enumeration&lt;String&gt; getHeaderNames();</code>  è·å–æ‰€æœ‰çš„è¯·æ±‚å¤´åç§°</li>
    </ul>
  </li>
  <li>
    <p>è·å–è¯·æ±‚ä½“æ•°æ®</p>

    <ul>
      <li>
        <p>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯POST,æ‰æœ‰è¯·æ±‚ä½“æ•°æ®</p>
      </li>
      <li>
        <p>æ“ä½œæ­¥éª¤</p>

        <ol>
          <li>
            <p>è·å–å¯¹è±¡æµ</p>

            <p><code class="highlighter-rouge">BufferedReader getReader()</code> : è·å–å­—ç¬¦è¾“å…¥æµ,åªå¯ä»¥æ“ä½œå­—ç¬¦æ•°æ®</p>

            <p><code class="highlighter-rouge">ServletInputStream getInputStream()</code>: è·å–ç›´æ¥è¾“å…¥æµ,å¯ä»¥æ“ä½œæ‰€æœ‰ç±»å‹æ•°æ®</p>
          </li>
          <li>
            <p>å†ä»æµä¸­æ‹¿æ•°æ®</p>
          </li>
        </ol>
      </li>
    </ul>
  </li>
</ol>

<h5 id="2-å…¶ä»–åŠŸèƒ½é‡è¦ä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨requestå¯¹è±¡çš„æ–¹æ³•-----alarm_clock">2. å…¶ä»–åŠŸèƒ½(é‡è¦,ä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨requestå¯¹è±¡çš„æ–¹æ³•) â€‹ â€‹ â€‹ â€‹ :alarm_clock:</h5>

<ol>
  <li>
    <p><strong>è·å–è¯·æ±‚å‚æ•°(é€šç”¨,getå’Œpostéƒ½å¯ç”¨)</strong></p>

    <ol>
      <li><code class="highlighter-rouge">String getParameter(String name)</code>: æ ¹æ®å‚æ•°åç§°è·å–å‚æ•°å€¼</li>
      <li><code class="highlighter-rouge">String[] getParameterValues(String name)</code>: æ ¹æ®å‚æ•°åç§°è·å– å‚æ•°åç§°å’Œå‚æ•°å€¼çš„æ•°ç»„;å¤šç”¨äºå¤é€‰æ¡†(<code class="highlighter-rouge">hobby=xx&amp;hobby=xx2</code>)</li>
      <li><code class="highlighter-rouge">Enumeration&lt;String&gt; getParameterNames()</code>: è·å–æ‰€æœ‰è¯·æ±‚çš„å‚æ•°åç§°</li>
      <li><code class="highlighter-rouge">Map&lt;String,String[]&gt; getParameterMap()</code> : è·å–æ‰€æœ‰å‚æ•°çš„mapé›†åˆ</li>
    </ol>

    <p><strong>è¡¥å……: ä¸­æ–‡ä¹±ç é—®é¢˜</strong></p>

    <ul>
      <li>getæ–¹å¼: tomcat8å·²ç»“å°†getæ–¹å¼ä¹±ç é—®é¢˜è§£å†³äº†</li>
      <li>postæ–¹å¼: ä¼šä¹±ç  (è§£å†³æ–¹æ¡ˆ: åœ¨è·å–å‚æ•°å‰,è®¾ç½®requestçš„ç¼–ç <code class="highlighter-rouge">request.setCharacterEncoding("utf-8")</code>)</li>
    </ul>
  </li>
  <li>
    <p><strong>è¯·æ±‚è½¬å‘</strong></p>

    <ol>
      <li>æ­¥éª¤:
        <ul>
          <li>é€šè¿‡requestå¯¹è±¡è·å–è¯·æ±‚è½¬å‘å™¨å¯¹è±¡: <code class="highlighter-rouge">request.getRequestDispatcher(String path)</code></li>
          <li>ä½¿ç”¨RequestDispatcherå¯¹è±¡æ¥è¿›è¡Œè½¬å‘: <code class="highlighter-rouge">forward(ServletRequest request, ServletResponse response)</code></li>
        </ul>
      </li>
      <li>ç‰¹ç‚¹
        <ul>
          <li>æµè§ˆå™¨åœ°å€æ è·¯å¾„ä¸å‘ç”Ÿå˜åŒ–</li>
          <li>åªèƒ½è½¬å‘åˆ°å½“å‰æœåŠ¡å™¨å†…éƒ¨èµ„æº(æ— æ³•è·³è½¬åˆ°å…¶ä»–æœåŠ¡å™¨url)</li>
          <li>è½¬å‘å§‹ç»ˆåªæœ‰ä¸€æ¬¡è¯·æ±‚</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>å…±äº«æ•°æ®(è¯·æ±‚è½¬å‘éœ€è¦ä¼ é€’æ•°æ®)</strong></p>

    <ul>
      <li>åŸŸå¯¹è±¡: ä¸€ä¸ªæœ‰ä½œç”¨èŒƒå›´çš„å¯¹è±¡,å¯ä»¥åœ¨èŒƒå›´å†…å…±äº«æ•°æ®</li>
      <li>requeståŸŸ: ä»£è¡¨ä¸€æ¬¡è¯·æ±‚çš„èŒƒå›´,ä¸€èˆ¬ç”¨äºè¯·æ±‚è½¬å‘çš„å¤šä¸ªèµ„æºä¸­å…±äº«æ•°æ®
        <ol>
          <li><code class="highlighter-rouge">void setAttribute(String name,Object obj)</code>:å­˜å‚¨æ•°æ®</li>
          <li><code class="highlighter-rouge">Object getAttribute(String name)</code>: é€šè¿‡é”®è·å–å€¼</li>
          <li><code class="highlighter-rouge">void removeAttribute(String name)</code>: é€šè¿‡é”®ç§»é™¤é”®å€¼å¯¹</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>è·å–ServletContext</strong></p>

    <p>æ–¹æ³•: <code class="highlighter-rouge">getServletContext()</code></p>
  </li>
</ol>

<h3 id="å“åº”response">å“åº”response</h3>

<h4 id="1-å“åº”æ•°æ®æ ¼å¼">1. å“åº”æ•°æ®æ ¼å¼</h4>

<ul>
  <li>å“åº”è¡Œ
    <ol>
      <li>æ ¼å¼: <code class="highlighter-rouge">åè®®/ç‰ˆæœ¬ å“åº”çŠ¶æ€ç  çŠ¶æ€ç æè¿°</code></li>
      <li>ä»€ä¹ˆæ˜¯çŠ¶æ€ç : æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯æœ¬æ¬¡è¯·æ±‚å’Œå“åº”çš„ä¸€ä¸ªçŠ¶æ€(<em>éƒ½æ˜¯ä¸‰ä½æ•°å­—</em>)
        <ul>
          <li>1xx : æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·é¡¿æ¶ˆæ¯,ä½†å¹¶æ²¡æœ‰æ¥æ”¶å®Œæˆ,ç­‰å¾…ä¸€æ®µæ—¶é—´å,å‘é€1xx</li>
          <li>2xx : è¯·æ±‚å’Œå“åº”æˆåŠŸ</li>
          <li>3xx : é‡å®šå‘ (<code class="highlighter-rouge">302</code> - é‡å®šå‘é¡µé¢; <code class="highlighter-rouge">304</code> - è®¿é—®ç¼“å­˜)</li>
          <li>4xx : å®¢æˆ·ç«¯é”™è¯¯  (<code class="highlighter-rouge">404</code> - è¯·æ±‚è·¯å¾„é”™è¯¯; <code class="highlighter-rouge">405</code> - è¯·æ±‚æ–¹å¼æ²¡æœ‰å¯¹åº”çš„doXXXæ–¹æ³•)</li>
          <li>5xx : æœåŠ¡å™¨ç«¯å¼‚å¸¸ <code class="highlighter-rouge">500</code> - æœåŠ¡ç«¯ä»£ç é”™è¯¯</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <p>å“åº”å¤´</p>

    <ol>
      <li>æ ¼å¼ : å¤´åç§° : å€¼</li>
      <li>å¸¸è§å“åº”å¤´
        <ul>
          <li><code class="highlighter-rouge">Content-Type</code> : æœ¬æ¬¡å“åº”çš„æ•°æ®æ ¼å¼å’Œç¼–ç æ ¼å¼</li>
          <li><code class="highlighter-rouge">Content-disposition</code> : æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯ä»¥ä»€ä¹ˆæ ¼å¼æ‰“å¼€å“åº”ä½“æ•°æ®</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <p>å“åº”ç©ºè¡Œ</p>

    <p>é—´éš”å“åº”å¤´å’Œå“åº”ä½“</p>
  </li>
  <li>
    <p>å“åº”ä½“</p>

    <p>å“åº”æ•°æ®,å›¾ç‰‡å’Œç½‘é¡µç­‰</p>
  </li>
</ul>

<h4 id="2-responseå¯¹è±¡">2. responseå¯¹è±¡</h4>

<ol>
  <li>è®¾ç½®å“åº”è¡Œ
    <ul>
      <li><code class="highlighter-rouge">setStatus(int sc)</code></li>
    </ul>
  </li>
  <li>è®¾ç½®å“åº”å¤´
    <ul>
      <li><code class="highlighter-rouge">setHeader(String name, String value)</code></li>
    </ul>
  </li>
  <li>è®¾ç½®å“åº”ä½“(<strong>æ­¥éª¤</strong>)
    <ol>
      <li>è·å–è¾“å…¥æµ
        <ul>
          <li>å­—ç¬¦è¾“å‡ºæµ: <code class="highlighter-rouge">PrintWriter getWriter()</code></li>
          <li>ç›´æ¥è¾“å‡ºæµ : <code class="highlighter-rouge">ServletOutputStream getOutPutStream()</code></li>
        </ul>
      </li>
      <li>ä½¿ç”¨è¾“å‡ºæµ,è¾“å‡ºåˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</li>
    </ol>
  </li>
</ol>

<h4 id="3-responseæ¡ˆä¾‹">3. responseæ¡ˆä¾‹</h4>

<ol>
  <li>
    <p>é‡å®šå‘ (èµ„æºè·³è½¬)</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1.è®¾ç½®çŠ¶æ€ç </span>
<span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="mi">302</span><span class="o">);</span> <span class="c1">// é‡å®šå‘çŠ¶æ€ç </span>
<span class="c1">// 2.è®¾ç½®å“åº”å¤´</span>
<span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"location"</span><span class="o">,</span> <span class="s">"/day14/responseDemo2"</span><span class="o">);</span>
   
<span class="c1">// 3.ç®€å•çš„é‡å®šå‘æ–¹å¼</span>
<span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/day15/responseDemo2"</span><span class="o">);</span>
</code></pre></div>    </div>

    <p><em>ä¸è½¬å‘çš„æ¯”è¾ƒ</em></p>

    <ul>
      <li>è½¬å‘(forward)
        <ol>
          <li>è½¬å‘åœ°å€æ è·¯å¾„ä¸å˜</li>
          <li>è½¬å‘åªèƒ½è®¿é—®å½“å‰æœåŠ¡å™¨ä¸‹çš„èµ„æº</li>
          <li>è½¬å‘åªæ˜¯ä¸€æ¬¡è¯·æ±‚,å¯ä»¥ä½¿ç”¨requestå¯¹è±¡æ¥å…±äº«æ•°æ®</li>
        </ol>
      </li>
      <li>é‡å®šå‘(redirect)
        <ol>
          <li>åœ°å€æ å‘ç”Ÿå˜åŒ–</li>
          <li>é‡å®šå‘å¯ä»¥è®¿é—®å…¶ä»–ç«™ç‚¹èµ„æº</li>
          <li>é‡å®šå‘æ˜¯ä¸¤æ¬¡æ±‚æƒ…,ä¸èƒ½ä½¿ç”¨requestå¯¹è±¡æ¥å…±äº«æ•°æ®</li>
        </ol>
      </li>
    </ul>

    <p><em>è·¯å¾„å†™æ³•</em></p>

    <ul>
      <li>
        <p>è·¯å¾„åˆ†ç±»</p>

        <ol>
          <li>ç›¸å¯¹è·¯å¾„: é€šè¿‡ç›¸å¯¹ä½ç½®å…³ç³»ç¡®å®šä½ç½®(ä»¥ç‚¹å¼€å¤´ ./ æˆ–è€… ../)</li>
          <li>ç»å¯¹è·¯å¾„: <code class="highlighter-rouge">/day14/responseDemo2</code>æˆ–è€…urlåœ°å€</li>
        </ol>
      </li>
      <li>
        <p>åˆ¤æ–­è§„åˆ™ : åˆ¤æ–­å®šä¹‰çš„è·¯å¾„æ˜¯ç»™è°ç”¨çš„?åˆ¤æ–­è¯·æ±‚ä»å“ªæ¥</p>

        <ol>
          <li>
            <p>ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ä½¿ç”¨ : éœ€è¦æ·»åŠ è™šæ‹Ÿè·¯å¾„(å…¸å‹çš„é‡å®šå‘)</p>
          </li>
          <li>
            <p>ç»™æœåŠ¡å™¨ä½¿ç”¨ :ä¸éœ€è¦åŠ è™šæ‹Ÿè·¯å¾„(å…¸å‹çš„è½¬å‘)</p>
          </li>
          <li>
            <p><strong>åŠ¨æ€è·å–è™šæ‹Ÿç›®å½•</strong></p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åŠ¨æ€è·å–è™šæ‹Ÿç›®å½•</span>
<span class="nc">String</span> <span class="n">contextPath</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">();</span>
<span class="c1">// é‡å®šå‘</span>
<span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">contextPath</span> <span class="o">+</span> <span class="s">"/responseDemo2"</span><span class="o">);</span>
</code></pre></div>            </div>
          </li>
        </ol>
      </li>
    </ul>
  </li>
  <li>
    <p>æœåŠ¡å™¨è¾“å‡ºå­—ç¬¦æ•°æ®åˆ°æµè§ˆå™¨</p>
  </li>
  <li>
    <p>æœåŠ¡å™¨è¾“å‡ºå­—èŠ‚æ•°æ®åˆ°æµè§ˆå™¨</p>

    <ol>
      <li>
        <p>è·å–å­—èŠ‚è¾“å‡ºæµ</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 0.è®¾ç½®ç¼–ç </span>
<span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html;charset=utf-8"</span><span class="o">);</span>
<span class="c1">// 1.è·å–è¾“å‡ºæµ(å­—èŠ‚)</span>
<span class="nc">ServletOutputStream</span> <span class="n">sos</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
<span class="c1">// 2.è¾“å‡ºæ•°æ®</span>
<span class="n">sos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"ä½ å¥½"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">));</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>è¾“å‡ºæ•°æ® <code class="highlighter-rouge">write()</code> : ä¸éœ€è¦åˆ·æ–°,è¾“å‡ºåè‡ªåŠ¨é‡Šæ”¾</p>
      </li>
    </ol>
  </li>
  <li>
    <p>æœåŠ¡å™¨è¾“å‡ºå­—ç¬¦æ•°æ®åˆ°æµè§ˆå™¨</p>

    <ol>
      <li>
        <p>è·å–å­—ç¬¦è¾“å‡ºæµ</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// æœ€æ¨èçš„è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜</span>
<span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html;charset=utf-8"</span><span class="o">);</span>
<span class="c1">// 1.è·å–å­—ç¬¦è¾“å‡ºæµ</span>
<span class="nc">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
<span class="c1">// 2.è¾“å‡ºæ•°æ®</span>
<span class="n">pw</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"hello response"</span><span class="o">);</span> <span class="c1">// å†™å…¥response,å¯ä»¥è§£æhtmlæ ‡ç­¾</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>è¾“å‡ºæ•°æ® <code class="highlighter-rouge">write()</code> : ä¸éœ€è¦åˆ·æ–°,è¾“å‡ºåè‡ªåŠ¨é‡Šæ”¾</p>
      </li>
    </ol>
  </li>
  <li>
    <p>éªŒè¯ç éªŒè¯æ¡ˆä¾‹</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">heigth</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
<span class="c1">// 1.åˆ›å»ºä¸€ä¸ªå¯¹è±¡,å›¾ç‰‡</span>
<span class="nc">BufferedImage</span> <span class="n">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedImage</span><span class="o">(</span><span class="n">width</span><span class="o">,</span><span class="n">heigth</span><span class="o">,</span><span class="nc">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
   
<span class="c1">// 2.ç¾åŒ–å›¾ç‰‡</span>
<span class="c1">// 2.1 å¡«å……èƒŒæ™¯è‰²</span>
<span class="nc">Graphics</span> <span class="n">g</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">();</span> <span class="c1">// ç”»ç¬”å¯¹è±¡</span>
<span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="na">pink</span><span class="o">);</span>
<span class="n">g</span><span class="o">.</span><span class="na">fillRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">heigth</span><span class="o">);</span>
   
<span class="c1">// 2.2 è¾¹æ¡†</span>
<span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="na">blue</span><span class="o">);</span>
<span class="n">g</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
   
<span class="c1">// 2.3 å†™éªŒè¯ç </span>
<span class="nc">String</span> <span class="n">string</span> <span class="o">=</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span><span class="o">;</span>
<span class="c1">// åˆ›å»ºéšæœºè§’æ ‡</span>
<span class="nc">Random</span> <span class="n">ran</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">string</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
    <span class="c1">// è·å–éšæœºè§’æ ‡å¯¹åº”çš„éšæœºå­—ç¬¦</span>
    <span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="c1">// 2.3å†™éªŒè¯ç </span>
    <span class="n">g</span><span class="o">.</span><span class="na">drawString</span><span class="o">(</span><span class="n">ch</span> <span class="o">+</span> <span class="s">""</span><span class="o">,</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">i</span><span class="o">,</span> <span class="n">heigth</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
<span class="o">}</span>
   
<span class="c1">// 2.3 ç”»å¹²æ‰°çº¿</span>
<span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="na">green</span><span class="o">);</span>
<span class="c1">// éšæœºç”Ÿæˆåæ ‡ç‚¹</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">width</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">width</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">heigth</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">heigth</span><span class="o">);</span>
    <span class="n">g</span><span class="o">.</span><span class="na">drawLine</span><span class="o">(</span><span class="n">x1</span><span class="o">,</span> <span class="n">y1</span><span class="o">,</span> <span class="n">x2</span><span class="o">,</span> <span class="n">y2</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">g</span><span class="o">.</span><span class="na">drawLine</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">);</span>
<span class="c1">// 3.å°†å›¾ç‰‡è¾“å‡ºåˆ°é¡µé¢ä¸­</span>
<span class="nc">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">image</span><span class="o">,</span> <span class="s">"jpg"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 1.è·å–å›¾ç‰‡å¯¹è±¡</span>
        <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">checkCode</span><span class="dl">"</span><span class="p">);</span>
        <span class="c1">// 2.ç»‘å®šå•å‡»äº‹ä»¶</span>
        <span class="nx">img</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="c1">// åŠ æ—¶é—´æˆ³,æ¬ºéª—æœåŠ¡å™¨</span>
            <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
            <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/day14/checkCodeServlet</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">date</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
   
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"checkCode"</span> <span class="na">src=</span><span class="s">"/day14/checkCodeServlet"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"change"</span> <span class="na">href=</span><span class="s">"çœ‹ä¸æ¸…æ¢ä¸€å¼ ?"</span><span class="nt">&gt;&lt;/a&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>    </div>
  </li>
</ol>

:ET